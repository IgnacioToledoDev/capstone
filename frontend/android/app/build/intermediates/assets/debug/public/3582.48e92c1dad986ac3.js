"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3582],{3582:(I,A,u)=>{u.r(A),u.d(A,{AgregarVehiculoPageModule:()=>R});var y=u(177),d=u(4341),s=u(4742),C=u(8986),m=u(467),f=u(1626),e=u(3953),b=u(3656),k=u(5312),P=u(369);let V=(()=>{var t;class a{constructor(r,o){this.http=r,this.storageService=o,this.API_URL=k.c.API_URL_DEV,o.create()}getCarBrands(){var r=this;return(0,m.A)(function*(){try{var o;const n=yield r.getAuthHeaders();if(!n.has("Authorization"))return console.error("No se pudo recuperar el token de autenticaci\xf3n."),[];const c=yield r.http.get(`${r.API_URL}/jwt/cars/brands/all`,{headers:n}).toPromise();return c.success&&null!==(o=c.data)&&void 0!==o&&o.brands?c.data.brands.map(h=>({id:h.id,name:h.name})):(console.error("Respuesta no v\xe1lida al obtener las marcas de coches:",c),[])}catch(n){return console.error("Error al obtener las marcas de coches:",n),[]}})()}registerCar(r){var o=this;return(0,m.A)(function*(){try{const n=yield o.getAuthHeaders();if(!n.has("Authorization"))throw new Error("No se pudo recuperar el token de autenticaci\xf3n.");console.log("Datos de registro a enviar:",r,n);const c=yield o.http.post(`${o.API_URL}/jwt/cars/create`,r,{headers:n}).toPromise();if(console.log("Registro car exitoso:",c),c.success){const l=c.data.car,h={brand_id:l.brand_id,model:l.model,year:l.year,patent:l.patent,owner_id:l.owner_id,id:l.id,createdAt:l.created_at,updatedAt:l.updated_at};yield o.storageService.set("newcar",h),console.log('Datos del coche guardados en el Storage bajo "newcar":',h)}return c}catch(n){throw console.error("Error en el registro del coche:",n),n}})()}getAuthHeaders(){var r=this;return(0,m.A)(function*(){const o=yield r.storageService.get("datos");return new f.Lr({Authorization:`Bearer ${o?o.token:null}`})})()}}return(t=a).\u0275fac=function(r){return new(r||t)(e.KVO(f.Qq),e.KVO(P.w))},t.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"}),a})();function E(t,a){if(1&t&&(e.j41(0,"ion-select-option",10),e.EFF(1),e.k0s()),2&t){const i=a.$implicit;e.Y8G("value",i.id),e.R7$(),e.SpI(" ",i.name," ")}}function M(t,a){if(1&t&&(e.j41(0,"ion-select-option",10),e.EFF(1),e.k0s()),2&t){const i=a.$implicit;e.Y8G("value",i),e.R7$(),e.SpI(" ",i," ")}}function S(t,a){if(1&t&&(e.j41(0,"ion-select-option",10),e.EFF(1),e.k0s()),2&t){const i=a.$implicit;e.Y8G("value",i),e.R7$(),e.SpI(" ",i," ")}}const j=[{path:"",component:(()=>{var t;class a{constructor(r,o,n,c,l){this.formBuilder=r,this.navCtrl=o,this.alertController=n,this.CarService=c,this.storageService=l,this.carBrands=[],this.models=["Corolla","Civic","Mustang","Camaro"],this.years=[2020,2021,2022,2023],this.vehicleForm=this.formBuilder.group({brand:["",d.k0.required],model:["",d.k0.required],year:["",d.k0.required],patente:["",d.k0.required]})}ngOnInit(){var r=this;return(0,m.A)(function*(){try{const o=yield r.CarService.getCarBrands();o&&Array.isArray(o)?(r.carBrands=o,console.log("Marcas de coches cargadas:",r.carBrands)):console.error("Formato de marcas de coches no v\xe1lido:",o)}catch(o){console.error("Error al cargar las marcas de coches:",o),r.carBrands=[]}})()}goBack(){this.navCtrl.back()}showAlert(){var r=this;return(0,m.A)(function*(){yield(yield r.alertController.create({header:"\xc9xito",message:"Veh\xedculo agregado correctamente.",buttons:["OK"]})).present()})()}onSubmit(){var r=this;return(0,m.A)(function*(){if(r.vehicleForm.valid){const{brand:c,model:l,patente:h,year:F}=r.vehicleForm.value;try{var o;const g=yield r.storageService.get("newuser"),v=null==g||null===(o=g.user)||void 0===o?void 0:o.id;if(!v)throw new Error("No se encontr\xf3 el owner_id en el Storage.");const p=yield r.CarService.registerCar({brand_id:c,model:l,patent:h,owner_id:v,year:F});if(console.log("Registro exitoso:",p),!0===p.success){var n;const B=(null===(n=r.carBrands.find(G=>G.id===c))||void 0===n?void 0:n.name)||"Unknown brand";yield r.storageService.set("newcar",{brand:B,model:l,year:F,patente:h}),yield r.storageService.set("token",p.data.access_token),r.showAlert(),setTimeout(()=>{r.navCtrl.navigateForward("/mecanico/generar-servicio")},2e3)}else yield r.presentAlert("Error de registro",p.message||"No se pudo completar el registro.")}catch(g){console.error("Error en el registro:",g);let v="Error al crear veh\xedculo";g instanceof f.yz&&(404===g.status?v="Endpoint no encontrado. Verifica la URL del servidor.":g.error&&g.error.message&&(v=g.error.message)),r.presentAlert("Error de registro",v)}}else r.presentAlert("Formulario inv\xe1lido","Por favor, completa todos los campos requeridos.")})()}presentAlert(r,o){var n=this;return(0,m.A)(function*(){yield(yield n.alertController.create({header:r,message:o,buttons:["OK"]})).present()})()}}return(t=a).\u0275fac=function(r){return new(r||t)(e.rXU(d.ok),e.rXU(b.q9),e.rXU(s.hG),e.rXU(V),e.rXU(P.w))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-agregar-vehiculo"]],decls:30,vars:4,consts:[["slot","start"],[3,"click"],["name","arrow-back-outline"],[3,"ngSubmit","formGroup"],["formControlName","brand"],[3,"value",4,"ngFor","ngForOf"],["formControlName","model"],["formControlName","year"],["formControlName","patente"],["expand","full","type","submit"],[3,"value"]],template:function(r,o){1&r&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return o.goBack()}),e.nrm(4,"ion-icon",2),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6,"Generar veh\xedculo"),e.k0s()()(),e.j41(7,"ion-content")(8,"form",3),e.bIt("ngSubmit",function(){return o.onSubmit()}),e.j41(9,"ion-item")(10,"ion-label"),e.EFF(11,"Marca"),e.k0s(),e.j41(12,"ion-select",4),e.DNE(13,E,2,2,"ion-select-option",5),e.k0s()(),e.j41(14,"ion-item")(15,"ion-label"),e.EFF(16,"Modelo"),e.k0s(),e.j41(17,"ion-select",6),e.DNE(18,M,2,2,"ion-select-option",5),e.k0s()(),e.j41(19,"ion-item")(20,"ion-label"),e.EFF(21,"A\xf1o"),e.k0s(),e.j41(22,"ion-select",7),e.DNE(23,S,2,2,"ion-select-option",5),e.k0s()(),e.j41(24,"ion-item")(25,"ion-label"),e.EFF(26,"Patente"),e.k0s(),e.nrm(27,"ion-input",8),e.k0s(),e.j41(28,"ion-button",9),e.EFF(29,"Enviar"),e.k0s()()()),2&r&&(e.R7$(8),e.Y8G("formGroup",o.vehicleForm),e.R7$(5),e.Y8G("ngForOf",o.carBrands),e.R7$(5),e.Y8G("ngForOf",o.models),e.R7$(5),e.Y8G("ngForOf",o.years))},dependencies:[y.Sq,d.qT,d.BC,d.cb,s.Jm,s.QW,s.W9,s.eU,s.iq,s.$w,s.uz,s.he,s.Nm,s.Ip,s.BC,s.ai,s.Je,s.Gw,d.j4,d.JD],styles:["ion-content[_ngcontent-%COMP%]{--background: #1e1e1e;color:#fff}ion-content[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: #2e2e2e;--color: #ffffff}ion-content[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:20px;--background: #3880ff}ion-content[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:20px}ion-content[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:auto}"]}),a})()}];let w=(()=>{var t;class a{}return(t=a).\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[C.iI.forChild(j),C.iI]}),a})();var O=u(5553);let R=(()=>{var t;class a{}return(t=a).\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[y.MD,d.YN,s.bv,w,d.X1,O.h]}),a})()}}]);